<!-- ======= COMPARATEUR DYNAMIQUE (VERSION PROPRE) ======= -->
<section id="comparateur" style="margin-top:24px">
  <h2>Comparateur de prix</h2>

  <div class="cmp-toolbar">
    <label for="cmpProduct">Produit :</label>
    <select id="cmpProduct"></select>

    <label for="cmpSearch" class="hidden-sm">Filtrer vendeur :</label>
    <input id="cmpSearch" type="search" placeholder="Amazon, Leroy Merlin, …" />
  </div>

  <div class="cmp-product-head">
    <img id="cmpImage" alt="">
    <div>
      <h3 id="cmpTitle"></h3>
      <p id="cmpBrand" class="muted"></p>
    </div>
  </div>

  <div class="cmp-table-wrap">
    <table class="cmp-table" id="cmpTable" aria-describedby="cmpTitle">
      <thead>
        <tr>
          <th>Vendeur</th>
          <th>Prix</th>
          <th>Livraison</th>
          <th>Total</th>
          <th>Stock</th>
          <th></th>
        </tr>
      </thead>
      <tbody><!-- rempli par JS --></tbody>
    </table>
  </div>
</section>

<style>
  /* ---- Styles comparateur ---- */
  #comparateur h2{font-size:1.2rem;margin-bottom:12px}
  .cmp-toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 14px}
  .cmp-toolbar label{font-weight:600}
  #cmpProduct,#cmpSearch{padding:8px 10px;border:2px solid var(--border);border-radius:10px;background:#fff;min-width:220px}
  .cmp-product-head{display:flex;gap:12px;align-items:center;margin:12px 0}
  .cmp-product-head img{width:70px;height:70px;object-fit:cover;border:2px solid var(--border);border-radius:10px;background:#fff}
  .cmp-table-wrap{overflow:auto;border:2px solid var(--border);border-radius:14px}
  .cmp-table{width:100%;border-collapse:separate;border-spacing:0}
  .cmp-table thead th{text-align:left;padding:10px;border-bottom:2px solid var(--border);background:#f6f6f6}
  .cmp-table td{padding:10px;border-bottom:1px solid #eee}
  .cmp-table tr:last-child td{border-bottom:none}
  .cmp-table td:nth-child(4){font-weight:800}
  .cmp-go{padding:8px 10px;border:2px solid var(--border);border-radius:10px;background:var(--accent);font-weight:700;cursor:pointer;display:inline-block}
  .muted{color:var(--muted)}
  @media (max-width:520px){
    .hidden-sm{display:none}
    .cmp-table thead{display:none}
    .cmp-table tr{display:grid;grid-template-columns:1fr 1fr;gap:6px;border-bottom:2px solid var(--border);padding:10px}
    .cmp-table td{border:none;padding:0}
    .cmp-table td[data-label]:before{content:attr(data-label) " : ";font-weight:700}
    .cmp-table td:last-child{grid-column:1 / -1;margin-top:6px}
  }
</style>

<script>
/* ======= Données produits & offres (ICI UNIQUEMENT) ======= */
const catalog = [
  {
    id: 'echafaudageAlu',
    name: 'Échafaudage aluminium 4m',
    brand: 'Centaur / Hymer',
    image: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?q=80&w=600&auto=format&fit=crop',
    offers: [
      { vendor: 'Amazon',      price: 399.00, shipping: 0.00,  stock: 'En stock', url: '#' },
      { vendor: 'Manutan',     price: 419.00, shipping: 15.00, stock: '3-5 j',    url: '#' },
      { vendor: 'Brico Dépôt', price: 389.00, shipping: 29.00, stock: 'Magasin',  url: '#' }
    ]
  },
  {
    id: 'perceuse18v',
    name: 'Perceuse-visseuse 18V',
    brand: 'Makita / Bosch / DeWalt',
    image: 'https://images.unsplash.com/photo-1581091012184-7c54a6e2847d?q=80&w=600&auto=format&fit=crop',
    offers: [
      { vendor: 'Amazon',       price: 127.00, shipping: 0.00, stock: 'En stock', url: '#' },
      { vendor: 'Leroy Merlin', price: 129.90, shipping: 5.90, stock: 'En stock', url: '#' },
      { vendor: 'ManoMano',     price: 125.00, shipping: 4.99, stock: '2-3 j',    url: '#' }
    ]
  },
  {
    id: 'casqueEN397',
    name: 'Casque de chantier EN397',
    brand: '3M / Delta Plus',
    image: 'https://images.unsplash.com/photo-1602751584552-9a5b4d2d6e53?q=80&w=600&auto=format&fit=crop',
    offers: [
      { vendor: 'Amazon',     price: 14.90, shipping: 2.90, stock: 'En stock', url: '#' },
      { vendor: 'Castorama',  price: 16.50, shipping: 5.50, stock: 'En stock', url: '#' },
      { vendor: 'Brico Dépôt',price: 13.99, shipping: 6.90, stock: 'Magasin',  url: '#' }
    ]
  },
  {
    id: 'scie190',
    name: 'Scie circulaire 190mm',
    brand: 'DeWalt / Makita',
    image: 'https://images.unsplash.com/photo-1568043210943-0d0f4e9b0c71?q=80&w=600&auto=format&fit=crop',
    offers: [
      { vendor: 'Amazon',       price: 129.00, shipping: 0.00, stock: 'En stock', url: '#' },
      { vendor: 'Leroy Merlin', price: 135.00, shipping: 5.90, stock: '2-4 j',    url: '#' },
      { vendor: 'Brico Privé',  price: 120.00, shipping: 7.90, stock: 'En stock', url: '#' }
    ]
  }
];

/* ======= Logique du comparateur ======= */
const € = n => n.toLocaleString('fr-FR',{style:'currency',currency:'EUR'});
const sel = id => document.getElementById(id);

const productSelect = sel('cmpProduct');
const searchInput   = sel('cmpSearch');
const tableBody     = sel('cmpTable').querySelector('tbody');
const titleEl       = sel('cmpTitle');
const brandEl       = sel('cmpBrand');
const imgEl         = sel('cmpImage');

// remplir la liste de produits
catalog.forEach(p => {
  const opt = document.createElement('option');
  opt.value = p.id; opt.textContent = p.name;
  productSelect.appendChild(opt);
});

function render(productId){
  const p = catalog.find(x => x.id === productId) || catalog[0];
  titleEl.textContent = p.name;
  brandEl.textContent = p.brand;
  imgEl.src = p.image; imgEl.alt = p.name;

  const q = (searchInput.value || '').trim().toLowerCase();
  const rows = p.offers
    .map(o => ({ ...o, total: o.price + o.shipping }))
    .filter(o => q ? o.vendor.toLowerCase().includes(q) : true)
    .sort((a,b) => a.total - b.total);

  tableBody.innerHTML = rows.map(o => `
    <tr>
      <td data-label="Vendeur">${o.vendor}</td>
      <td data-label="Prix">${€(o.price)}</td>
      <td data-label="Livraison">${€(o.shipping)}</td>
      <td data-label="Total"><strong>${€(o.total)}</strong></td>
      <td data-label="Stock">${o.stock}</td>
      <td data-label=""><a class="cmp-go" href="${o.url}" target="_blank" rel="noopener">Aller sur le site</a></td>
    </tr>
  `).join('');
}

// init
productSelect.value = catalog[0].id;
render(productSelect.value);

// events
productSelect.addEventListener('change', e => render(e.target.value));
searchInput.addEventListener('input',   () => render(productSelect.value));
</script>
<!-- ===== FIN / COMPARATEUR ===== -->
